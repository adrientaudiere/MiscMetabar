<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Assign taxonomy using LCA à la stampa — assign_vsearch_lca • MiscMetabar</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Assign taxonomy using LCA à la stampa — assign_vsearch_lca"><meta name="description" content="


Please cite Vsearch and
stampa if you use this function
to assign taxonomy."><meta property="og:description" content="


Please cite Vsearch and
stampa if you use this function
to assign taxonomy."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-secondary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MiscMetabar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.11.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/MiscMetabar.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/import_export_track.html">Import/export and track</a></li>
    <li><a class="dropdown-item" href="../articles/explore_data.html">Explore phyloseq data</a></li>
    <li><a class="dropdown-item" href="../articles/filter.html">Filter taxa and samples</a></li>
    <li><a class="dropdown-item" href="../articles/Reclustering.html">Reclustering</a></li>
    <li><a class="dropdown-item" href="../articles/tree_visualization.html">Tree building and visualization</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Diversity analysis</h6></li>
    <li><a class="dropdown-item" href="../articles/alpha-div.html">Alpha-diversity</a></li>
    <li><a class="dropdown-item" href="../articles/beta-div.html">Beta-diversity</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Bioinformatics actions</h6></li>
    <li><a class="dropdown-item" href="../articles/fastq_quality_check.html">Fastq quality check</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Examples with published dataset</h6></li>
    <li><a class="dropdown-item" href="../articles/tengeler.html">Tengeler dataset</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>R ecosystem for metabarcoding</h6></li>
    <li><a class="dropdown-item" href="../articles/states_of_fields_in_R.html">Metabarcoding with R</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>For developpers</h6></li>
    <li><a class="dropdown-item" href="../articles/Rules.html">Rules of code</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/adrientaudiere/MiscMetabar/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Assign taxonomy using LCA <strong>à la</strong> <a href="https://github.com/frederic-mahe/stampa" class="external-link">stampa</a></h1>
      <small class="dont-index">Source: <a href="https://github.com/adrientaudiere/MiscMetabar/blob/HEAD/R/vsearch.R" class="external-link"><code>R/vsearch.R</code></a></small>
      <div class="d-none name"><code>assign_vsearch_lca.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><a href="https://adrientaudiere.github.io/MiscMetabar/articles/Rules.html#lifecycle">
<img src="https://img.shields.io/badge/lifecycle-experimental-orange" alt="lifecycle-experimental"></a></p>

<p>Please cite <a href="https://github.com/torognes/vsearch" class="external-link">Vsearch</a> and
<a href="https://github.com/frederic-mahe/stampa" class="external-link">stampa</a> if you use this function
to assign taxonomy.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">assign_vsearch_lca</span><span class="op">(</span></span>
<span>  physeq <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  seq2search <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ref_fasta <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  behavior <span class="op">=</span> <span class="st">"return_matrix"</span>,</span>
<span>  vsearchpath <span class="op">=</span> <span class="st">"vsearch"</span>,</span>
<span>  clean_pq <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  taxo_rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"K"</span>, <span class="st">"P"</span>, <span class="st">"C"</span>, <span class="st">"O"</span>, <span class="st">"F"</span>, <span class="st">"G"</span>, <span class="st">"S"</span><span class="op">)</span>,</span>
<span>  nproc <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  suffix <span class="op">=</span> <span class="st">""</span>,</span>
<span>  id <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  lca_cutoff <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  maxrejects <span class="op">=</span> <span class="fl">32</span>,</span>
<span>  top_hits_only <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  maxaccepts <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  keep_temporary_files <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  temporary_fasta_file <span class="op">=</span> <span class="st">"temp.fasta"</span>,</span>
<span>  cmd_args <span class="op">=</span> <span class="st">""</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-physeq">physeq<a class="anchor" aria-label="anchor" href="#arg-physeq"></a></dt>
<dd><p>(required): a <code><a href="https://rdrr.io/pkg/phyloseq/man/phyloseq-class.html" class="external-link">phyloseq-class</a></code> object obtained
using the <code>phyloseq</code> package.</p></dd>


<dt id="arg-seq-search">seq2search<a class="anchor" aria-label="anchor" href="#arg-seq-search"></a></dt>
<dd><p>A DNAStringSet object of sequences to search for.</p></dd>


<dt id="arg-ref-fasta">ref_fasta<a class="anchor" aria-label="anchor" href="#arg-ref-fasta"></a></dt>
<dd><p>(required) A link to a database in vsearch format
The reference database must contain taxonomic information in the header of
each sequence in the form of a string starting with ";tax=" and followed
by a comma-separated list of up to nine taxonomic identifiers. Each taxonomic
identifier must start with an indication of the rank by one of the letters d
(for domain) k (kingdom), p (phylum), c (class), o (order), f (family),
g (genus), s (species), or t (strain). The letter is followed by a colon
(:) and the name of that rank. Commas and semicolons are not allowed in
the name of the rank. Non-ascii characters should be avoided in the names.</p>
<p>Example:</p>
<p>\&gt;X80725_S000004313;tax=d:Bacteria,p:Proteobacteria,c:Gammaproteobacteria,o:Enterobacteriales,f:Enterobacteriaceae,g:Escherichia/Shigella,s:Escherichia_coli,t:str._K-12_substr._MG1655</p></dd>


<dt id="arg-behavior">behavior<a class="anchor" aria-label="anchor" href="#arg-behavior"></a></dt>
<dd><p>Either "return_matrix" (default), "return_cmd",
or "add_to_phyloseq":</p><ul><li><p>"return_matrix" return a list of two matrix with taxonomic value in the
first element of the list and bootstrap value in the second one.</p></li>
<li><p>"return_cmd" return the command to run without running it.</p></li>
<li><p>"add_to_phyloseq" return a phyloseq object with amended slot <code>@taxtable</code>.
Only available if using physeq input and not seq2search input.</p></li>
</ul></dd>


<dt id="arg-vsearchpath">vsearchpath<a class="anchor" aria-label="anchor" href="#arg-vsearchpath"></a></dt>
<dd><p>(default: "vsearch") path to vsearch</p></dd>


<dt id="arg-clean-pq">clean_pq<a class="anchor" aria-label="anchor" href="#arg-clean-pq"></a></dt>
<dd><p>(logical, default TRUE)
If set to TRUE, empty samples and empty ASV are discarded
before clustering.</p></dd>


<dt id="arg-taxo-rank">taxo_rank<a class="anchor" aria-label="anchor" href="#arg-taxo-rank"></a></dt>
<dd><p>A list with the name of the taxonomic rank present in
ref_fasta</p></dd>


<dt id="arg-nproc">nproc<a class="anchor" aria-label="anchor" href="#arg-nproc"></a></dt>
<dd><p>(int, default: 1)
Set to number of cpus/processors to use</p></dd>


<dt id="arg-suffix">suffix<a class="anchor" aria-label="anchor" href="#arg-suffix"></a></dt>
<dd><p>(character) The suffix to name the new columns.
If set to "" (the default), the taxo_rank algorithm is used
without suffix.</p></dd>


<dt id="arg-id">id<a class="anchor" aria-label="anchor" href="#arg-id"></a></dt>
<dd><p>(Int. [0:1] default 0.5). Default value is based on
<a href="https://github.com/frederic-mahe/stampa" class="external-link">stampa</a>.
See Vsearch Manual for parameter <code>--id</code></p></dd>


<dt id="arg-lca-cutoff">lca_cutoff<a class="anchor" aria-label="anchor" href="#arg-lca-cutoff"></a></dt>
<dd><p>(int, default 1). Fraction of matching hits
required for the last common ancestor (LCA) output. For example, a value
of 0.9 imply that if less than 10% of assigned species are not congruent
the taxonomy is filled.
Default value is based on <a href="https://github.com/frederic-mahe/stampa" class="external-link">stampa</a>.
See Vsearch Manual for parameter <code>--lca_cutoff</code></p>
<p>Text from vsearch manual :
"Adjust the fraction of matching hits required for the last
common ancestor (LCA) output with the –lcaout option during searches.
The default value is 1.0 which requires all hits to match at each taxonomic
rank for that rank to be included. If a lower cutoff value is used,
e.g. 0.95, a small fraction of non-matching hits are allowed while that
rank will still be reported. The argument to this option must be larger
than 0.5, but not larger than 1.0"</p></dd>


<dt id="arg-maxrejects">maxrejects<a class="anchor" aria-label="anchor" href="#arg-maxrejects"></a></dt>
<dd><p>(int, default: 32)
Maximum number of non-matching target sequences to consider before
stopping the search for a given query.
Default value is based on <a href="https://github.com/frederic-mahe/stampa" class="external-link">stampa</a>
See Vsearch Manual for parameter <code>--maxrejects</code>.</p></dd>


<dt id="arg-top-hits-only">top_hits_only<a class="anchor" aria-label="anchor" href="#arg-top-hits-only"></a></dt>
<dd><p>(Logical, default TRUE)
Only the top hits with an equally high percentage of identity between the query and
database sequence sets are written to the output. If you set top_hits_only
you may need to set a lower <code>maxaccepts</code> and/or <code>lca_cutoof</code>.
Default value is based on <a href="https://github.com/frederic-mahe/stampa" class="external-link">stampa</a>
See Vsearch Manual for parameter <code>--top_hits_only</code></p></dd>


<dt id="arg-maxaccepts">maxaccepts<a class="anchor" aria-label="anchor" href="#arg-maxaccepts"></a></dt>
<dd><p>(int, default: 0)
Default value is based on <a href="https://github.com/frederic-mahe/stampa" class="external-link">stampa</a>.
Maximum number of matching target sequences to accept before stopping the search
for a given query.
See Vsearch Manual for parameter <code>--maxaccepts</code></p></dd>


<dt id="arg-keep-temporary-files">keep_temporary_files<a class="anchor" aria-label="anchor" href="#arg-keep-temporary-files"></a></dt>
<dd><p>(logical, default: FALSE) Do we keep temporary files?</p><ul><li><p>temporary_fasta_file (default "temp.fasta") : the fasta file from physeq or
seq2search</p></li>
<li><p>"out_lca.txt" : see Vsearch Manual for parameter –lcaout</p></li>
<li><p>"userout.txt" : see Vsearch Manual for parameter –userout</p></li>
</ul></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>(logical). If TRUE, print additional information.</p></dd>


<dt id="arg-temporary-fasta-file">temporary_fasta_file<a class="anchor" aria-label="anchor" href="#arg-temporary-fasta-file"></a></dt>
<dd><p>Name of the temporary fasta file. Only useful
with keep_temporary_files = TRUE.</p></dd>


<dt id="arg-cmd-args">cmd_args<a class="anchor" aria-label="anchor" href="#arg-cmd-args"></a></dt>
<dd><p>Other arguments to be passed on to vsearch usearch_global cmd.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>See param behavior</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function is mainly a wrapper of the work of others.
Please cite <a href="https://github.com/torognes/vsearch" class="external-link">vsearch</a> and
<a href="https://github.com/frederic-mahe/stampa" class="external-link">stampa</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="assign_sintax.html">assign_sintax()</a></code>, <code><a href="add_new_taxonomy_pq.html">add_new_taxonomy_pq()</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Adrien Taudière</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="va">data_fungi_mini_new</span> <span class="op">&lt;-</span> <span class="fu">assign_vsearch_lca</span><span class="op">(</span><span class="va">data_fungi_mini</span>,</span></span>
<span class="r-in"><span>  ref_fasta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"mini_UNITE_fungi.fasta.gz"</span>, package <span class="op">=</span> <span class="st">"MiscMetabar"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  lca_cutoff <span class="op">=</span> <span class="fl">0.9</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Cleaning suppress 0 taxa and 0 samples.</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Adrien Taudière.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

